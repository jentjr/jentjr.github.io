<body>
  <!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="" name="keywords">
<meta content="Reading Excel Files in R - jrj" property="og:title">
<title>Reading Excel Files in R | jrj</title>
<link rel="stylesheet" href="http://jentjr.github.io/css/style.css">
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous" />


  <section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="http://jentjr.github.io/"><h1 class="title is-4">jrj</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
        </nav>
      </div>
    </nav>
  </div>
</section>

  <section class="section">
    <div class="container">
      <h2 class="subtitle is-6">October 15, 2015</h2>
      <h1 class="title">Reading Excel Files in R</h1>
      
      <div class="content">
        <p><a href="http://had.co.nz">Hadley Wickham</a> recently started an R package for reading excel files called <a href="https://github.com/hadley/readxl">readxl</a>. The package has no external dependencies, which makes it easy to install. If you have worked with other packages for reading excel files like <a href="https://github.com/miraisolutions/xlconnect">XLConnect</a>, which uses java, it might not be straightforward to get the package working. For example, you might have to reconfigure java on your computer by running command below in your terminal.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>sudo R CMD javareconf
</pre></div>


<p>The syntax in readxl is much cleaner and straightforward than some of the other packages for reading excel files, which makes it much nicer to use. However, while there are sure to be many improvements to come (at the time of this writing readxl is at version 0.1.0.9000), there are some features that are missing. One of the things I wanted to do was read an excel file from a url the way you can in the <a href="https://cran.r-project.org/web/packages/gdata/index.html">gdata</a> package. So, I forked the readxl repo, and modified the <code>read_excel</code> function in the <code>read_excel.R</code> file as follows:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>read_excel <span style="color: #f92672">&lt;-</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">(</span>path<span style="color: #f8f8f2">,</span> sheet <span style="color: #f92672">=</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> col_names <span style="color: #f92672">=</span> <span style="color: #66d9ef">TRUE</span><span style="color: #f8f8f2">,</span> col_types <span style="color: #f92672">=</span> <span style="color: #66d9ef">NULL</span><span style="color: #f8f8f2">,</span>
                       na <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;&quot;</span><span style="color: #f8f8f2">,</span> skip <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
			
   <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(</span><span style="color: #66d9ef">substring</span><span style="color: #f8f8f2">(</span>path<span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">7</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;http://&quot;</span> <span style="color: #f92672">||</span>
       <span style="color: #66d9ef">substring</span><span style="color: #f8f8f2">(</span>path<span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">6</span><span style="color: #f8f8f2">)</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;ftp://&quot;</span><span style="color: #f8f8f2">)</span> <span style="color: #f8f8f2">{</span>
     ext <span style="color: #f92672">&lt;-</span> <span style="color: #66d9ef">tolower</span><span style="color: #f8f8f2">(</span>tools<span style="color: #f92672">::</span>file_ext<span style="color: #f8f8f2">(</span>path<span style="color: #f8f8f2">))</span>
     tmp <span style="color: #f92672">&lt;-</span> <span style="color: #66d9ef">tempfile</span><span style="color: #f8f8f2">(</span>fileext <span style="color: #f92672">=</span> <span style="color: #66d9ef">paste0</span><span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;.&quot;</span><span style="color: #f8f8f2">,</span> ext<span style="color: #f8f8f2">))</span>
     download.file<span style="color: #f8f8f2">(</span>path<span style="color: #f8f8f2">,</span> destfile <span style="color: #f92672">=</span> tmp<span style="color: #f8f8f2">,</span> mode <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;wb&quot;</span><span style="color: #f8f8f2">)</span>
			  
     <span style="color: #66d9ef">switch</span><span style="color: #f8f8f2">(</span>excel_format<span style="color: #f8f8f2">(</span>tmp<span style="color: #f8f8f2">),</span>
            xls <span style="color: #f92672">=</span>  read_xls<span style="color: #f8f8f2">(</span>tmp<span style="color: #f8f8f2">,</span> sheet<span style="color: #f8f8f2">,</span> col_names<span style="color: #f8f8f2">,</span> col_types<span style="color: #f8f8f2">,</span> na<span style="color: #f8f8f2">,</span> skip<span style="color: #f8f8f2">),</span>
            xlsx <span style="color: #f92672">=</span> read_xlsx<span style="color: #f8f8f2">(</span>tmp<span style="color: #f8f8f2">,</span> sheet<span style="color: #f8f8f2">,</span> col_names<span style="color: #f8f8f2">,</span> col_types<span style="color: #f8f8f2">,</span> na<span style="color: #f8f8f2">,</span> skip<span style="color: #f8f8f2">)</span>
     <span style="color: #f8f8f2">)</span>
   <span style="color: #f8f8f2">}</span>
   <span style="color: #66d9ef">else</span> <span style="color: #f8f8f2">{</span>
     path <span style="color: #f92672">&lt;-</span> check_file<span style="color: #f8f8f2">(</span>path<span style="color: #f8f8f2">)</span>
     ext <span style="color: #f92672">&lt;-</span> <span style="color: #66d9ef">tolower</span><span style="color: #f8f8f2">(</span>tools<span style="color: #f92672">::</span>file_ext<span style="color: #f8f8f2">(</span>path<span style="color: #f8f8f2">))</span>
			  
     <span style="color: #66d9ef">switch</span><span style="color: #f8f8f2">(</span>excel_format<span style="color: #f8f8f2">(</span>path<span style="color: #f8f8f2">),</span>
	    xls <span style="color: #f92672">=</span>  read_xls<span style="color: #f8f8f2">(</span>path<span style="color: #f8f8f2">,</span> sheet<span style="color: #f8f8f2">,</span> col_names<span style="color: #f8f8f2">,</span> col_types<span style="color: #f8f8f2">,</span> na<span style="color: #f8f8f2">,</span> skip<span style="color: #f8f8f2">),</span>
	    xlsx <span style="color: #f92672">=</span> read_xlsx<span style="color: #f8f8f2">(</span>path<span style="color: #f8f8f2">,</span> sheet<span style="color: #f8f8f2">,</span> col_names<span style="color: #f8f8f2">,</span> col_types<span style="color: #f8f8f2">,</span> na<span style="color: #f8f8f2">,</span> skip<span style="color: #f8f8f2">)</span>
     <span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<p>I submitted a <a href="https://github.com/hadley/readxl/pull/77">pull request</a>, which Hadley Wickham said he would take a look at next time he is working on the readxl package.</p>

<p>In the next post I will use the <code>read_excel</code> function to download groundwater quality data from the state of Indiana.</p>

      </div>
    </div>
  </section>
  

  <section class="section">
  <div class="container has-text-centered">
    <p></p>
  </div>
</section>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script>hljs.initHighlightingOnLoad();</script>


</body>
